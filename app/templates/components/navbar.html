<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm sticky-top py-2">
    <div class="container">
        <a class="navbar-brand d-flex align-items-center" href="/">
            <img src="/static/img/img1.png" alt="Logo Jombang" style="height: 45px; width: auto; max-width: 100%;" class="me-2">

            <div class="vr mx-2 text-white opacity-50 d-none d-sm-block" style="height: 30px;"></div>

            <img src="/static/img/img2.png" alt="Logo Dishub" style="height: 35px; width: auto; max-width: 100%;" class="me-2 d-none d-sm-block">

            <div class="ms-1">
                <span class="fw-bold d-block lh-1" style="letter-spacing: 1px;">LAPORPAK!</span>
                <small class="opacity-75 d-block" style="font-size: 0.65rem;">DISHUB KAB. JOMBANG</small>
            </div>
        </a>

        <div class="d-none d-lg-flex align-items-center ms-auto me-4 text-white border-end pe-4">
            <div class="text-end me-3">
                <small class="d-block opacity-75" id="date-now" style="font-size: 0.7rem;"></small>
                <span class="fw-bold" id="clock-now" style="font-size: 0.9rem;"></span>
            </div>
            <div class="d-flex align-items-center bg-white bg-opacity-10 px-3 py-1 rounded-pill">
                <i class="bi bi-cloud-sun-fill text-warning me-2"></i>
                <span class="fw-bold small">29°C</span>
            </div>
        </div>

        <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav align-items-center">
                <li class="nav-item"><a class="nav-link fw-medium text-white" href="{{ url_for('main.feed') }}">Feed Publik</a></li>

                {% if current_user.is_authenticated %}
                <li class="nav-item dropdown ms-lg-3">
                    <a class="nav-link dropdown-toggle btn btn-white bg-white text-primary rounded-pill px-3 btn-sm fw-bold" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="bi bi-person-circle me-1"></i> {{ current_user.nama }}
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end shadow border-0 mt-2" aria-labelledby="userDropdown">
                        <li><a class="dropdown-item py-2" href="{{ url_for('user.dashboard' if current_user.role == 'user' else 'admin.dashboard') }}">
                            <i class="bi bi-speedometer2 me-2"></i> Dashboard
                        </a></li>
                        <li><a class="dropdown-item py-2" href="{{ url_for('user.profile') }}">
                            <i class="bi bi-person me-2"></i> Profil Saya
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item py-2 text-danger" href="{{ url_for('auth.logout') }}">
                            <i class="bi bi-box-arrow-right me-2"></i> Logout
                        </a></li>
                    </ul>
                </li>
                {% else %}
                <li class="nav-item ms-lg-3"><a class="nav-link text-white" href="{{ url_for('auth.login') }}">Login</a></li>
                <li class="nav-item ms-lg-2">
                    <a href="{{ url_for('auth.register') }}" class="btn btn-warning rounded-pill px-4 btn-sm fw-bold shadow-sm">DAFTAR</a>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

<div class="bg-dark text-white py-2 overflow-hidden border-top border-warning border-3">
    <div class="container d-flex align-items-center">
        <span class="badge bg-danger animate-pulse me-3 shadow-sm">BREAKING NEWS</span>
        <marquee class="small fw-light pt-1" scrollamount="5">
            {# MENGHUBUNGKAN DENGAN BACKEND BROADCAST #}
            {% if running_text %}
                {{ running_text }}
            {% else %}
                Selamat Datang di Layanan LaporPak! Dishub Jombang — Laporkan kendala marka jalan, lampu PJU mati, atau parkir liar melalui portal resmi ini — Demi kenyamanan transportasi Jombang.
            {% endif %}
        </marquee>
    </div>
</div>

<style>
    .animate-pulse { animation: pulse-red 2s infinite; }
    @keyframes pulse-red {
        0% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
        70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
        100% { transform: scale(0.95); box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
    }

    /* Perbaikan Vital: Memaksa gambar tetap di dalam ukuran navbar */
    .navbar-brand img {
        height: 45px !important;
        width: auto !important;
        object-fit: contain;
        display: inline-block;
    }

    .navbar-brand img[alt="Logo Dishub"] {
        height: 35px !important;
    }
</style>

<script>
    // Script untuk update Jam dan Tanggal di Navbar
    function updateClock() {
        const now = new Date();
        const optionsDate = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
        const dateStr = now.toLocaleDateString('id-ID', optionsDate);
        const timeStr = now.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

        const dateEl = document.getElementById('date-now');
        const clockEl = document.getElementById('clock-now');

        if(dateEl) dateEl.innerText = dateStr;
        if(clockEl) clockEl.innerText = timeStr + " WIB";
    }
    setInterval(updateClock, 1000);
    updateClock();
</script>